require "eltiempo/version"
require 'net/http'
require 'nokogiri'


module Eltiempo
  class Temperature
    
    URI_ENDPOINT = "https://api.tiempo.com/index.php"

    def execute_call(params)
    	begin
	    	uri = URI(URI_ENDPOINT)
	    	params.merge!({:api_lang => "en", :affiliate_id => "zdo2c683olan"})
			uri.query = URI.encode_www_form(params)

			res = Net::HTTP.get_response(uri)
			return res.body if res.is_a?(Net::HTTPSuccess)
			return false if res.is_a?(Net::HTTPError)
		rescue
			# we manage the error in the bin/eltiempo file
		end
	end
	
	def parseResponse(resp_body)
		out = {}
		
		# we parse the XML file to extract the data
		doc = Nokogiri::XML(resp_body)
		
		doc.xpath("//var").each do |n|
	    	case n.xpath('name').text()
	    	when "Minimum Temperature"
	    		# we get all the min values to get the average
	    		values = n.xpath("data//forecast/@value").map{|a| a.text().to_i}
	    		# we save the first value (which belongs to today) to get 
	    		# the min temperature of today
	    		@today_min = values.first
	    		total = values.inject(0){|sum,x| sum + x }
	    		out.merge!(:av_min => (total/values.length))
	    	when "Maximum Temperature"
	    		# we get all the max values to get the average
	    		values = n.xpath("data//forecast/@value").map{|a| a.text().to_i}
	    		# we save the first value (which belongs to today) to get 
	    		# the max temperature of today
	    		@today_max = values.first
	    		total = values.inject(0){|sum,x| sum + x }
	    		out.merge!(:av_max => (total/values.length))
	    	end
	   	end

		out.merge!({:today =>((@today_max+@today_min)/2)}) if @today_max && @today_min
		out
	end

	private :execute_call, :parseResponse
    
    def today(city_id)
     	resp = execute_call({:localidad => city_id}) if city_id
     	return parseResponse(resp)[:today] if resp
    end

    def av_max(city_id)
    	resp = execute_call({:localidad => city_id}) if city_id
    	return parseResponse(resp)[:av_max] if resp
    end

    def av_min(city_id)
    	resp = execute_call({:localidad => city_id}) if city_id
      return parseResponse(resp)[:av_min] if resp
    end
  end

  class City
  	AVAILABLE_CITIES= {
		"abrera" => 1182,
		"agora parc" => 79254,
		"aguilar de segarra" => 1183,
		"aiguafreda" => 1195,
		"aire sol" => 79276,
		"albarells" => 79403,
		"alella" => 1184,
		"alella parc" => 79326,
		"aleny" => 79268,
		"alpens" => 1185,
		"l' ametlla del vallès" => 1186,
		"arenys de mar" => 1187,
		"arenys de munt" => 1188,
		"argençola" => 1189,
		"argentona" => 1190,
		"artés" => 1191,
		"avià" => 1192,
		"avinyó" => 1193,
		"avinyó nou" => 79284,
		"avinyonet del penedès" => 1194,
		"badalona" => 1196,
		"badia del vallès" => 1155,
		"bagà" => 1197,
		"balenyà" => 1198,
		"balsareny" => 1199,
		"barberà del vallès" => 1319,
		"barcelona" => 1200,
		"airport barcelona" => 11915,
		"barri cel blau" => 79349,
		"barri marquet paradís" => 79310,
		"barri mont-rodon" => 79435,
		"barri de la creu" => 79340,
		"barri del roser" => 79459,
		"barri la pineda" => 79244,
		"begues" => 1201,
		"begues parc" => 79251,
		"bellaterra" => 79196,
		"bellprat" => 1202,
		"bellver" => 79390,
		"berga" => 1203,
		"bergús" => 79371,
		"bigues" => 79381,
		"bigues i riells" => 1204,
		"bojons" => 79485,
		"bonavista" => 79458,
		"borgonyà" => 79294,
		"borredà" => 1205,
		"borrissola" => 79444,
		"el bruc" => 1206,
		"bruguers" => 79463,
		"el brull" => 1207,
		"buida-sacs" => 79418,
		"ca l'alaio" => 79420,
		"ca l'alegre" => 79481,
		"ca l'esmandia" => 79293,
		"ca l'esteper" => 79373,
		"ca l'oliva" => 79500,
		"ca n'olivella" => 79362,
		"les cabanyes" => 1208,
		"cabrera d'igualada" => 1209,
		"cabrera de mar" => 1210,
		"cabrianes" => 79379,
		"cabrils" => 1211,
		"cal piquer" => 79278,
		"cal rubió" => 79367,
		"cal surià" => 79426,
		"calaf" => 1212,
		"calders" => 1215,
		"caldes d'estrac" => 1213,
		"caldes de montbui" => 1214,
		"calella" => 1216,
		"california" => 79368,
		"calldetenes" => 1218,
		"callús" => 1219,
		"calonge de segarra" => 1217,
		"campins" => 1220,
		"can bartomeu" => 79489,
		"can battle" => 79416,
		"can bonastre" => 79285,
		"can bosc" => 79324,
		"can bruguera" => 79333,
		"can catassús" => 79442,
		"can coral" => 79377,
		"can creixell" => 79273,
		"can farell" => 79265,
		"can gonteres" => 79253,
		"can guitart vell" => 79449,
		"can mitjans" => 79343,
		"can palet de vista alegre" => 79508,
		"can parellada" => 79445,
		"can paulet" => 79384,
		"can quiseró" => 79204,
		"can regassol" => 79415,
		"can rial" => 79312,
		"can ros" => 79443,
		"can rossell" => 79387,
		"can sabater" => 79466,
		"can salvatella" => 79427,
		"can valls" => 79345,
		"can vila-seca" => 79353,
		"can vilardell" => 79374,
		"can n'amat d'ullastrell" => 79369,
		"canadà parc" => 79483,
		"canet de fals" => 79468,
		"canet de mar" => 1221,
		"canovelles" => 1222,
		"cànoves" => 79256,
		"cànoves i samalús" => 1223,
		"cantallops" => 79376,
		"cantonigròs" => 79202,
		"canyamars" => 79212,
		"canyelles" => 1224,
		"capellades" => 1225,
		"capolat" => 1226,
		"carbasí" => 79448,
		"cardedeu" => 1227,
		"cardona" => 1228,
		"carme" => 1229,
		"casserres" => 1230,
		"castell de cardona" => 79274,
		"castell de l'areny" => 1238,
		"castelladral" => 79222,
		"castellar" => 79491,
		"castellar de n'hug" => 1233,
		"castellar del riu" => 1231,
		"castellar del vallès" => 1232,
		"castellarnau" => 79319,
		"castellbell i el vilar" => 1234,
		"castellbisbal" => 1235,
		"castellcir" => 1236,
		"castelldefels" => 1237,
		"castellet" => 79382,
		"castellet i la gornal" => 1239,
		"castellfollit de riubregós" => 1241,
		"castellfollit del boix" => 1240,
		"castellgalí" => 1242,
		"castellnou de bages" => 1243,
		"castellolí" => 1244,
		"castellterçol" => 1245,
		"castellví de rosanes" => 1247,
		"castellví de la marca" => 1246,
		"centelles" => 1248,
		"cercs" => 1335,
		"cerdanyola del vallès" => 1333,
		"cerdinyola" => 79493,
		"cervelló" => 1249,
		"cesalpina" => 79406,
		"clariana" => 79397,
		"cobert de puigcercós" => 79247,
		"coforb" => 79429,
		"collbató" => 1250,
		"collcabiro" => 79292,
		"collsacreu" => 79302,
		"collsuspina" => 1251,
		"colònia güell" => 79439,
		"colonia imbern" => 79288,
		"colònia vilafruns" => 79407,
		"conill" => 79346,
		"copons" => 1252,
		"corbera de dalt" => 79336,
		"corbera de llobregat" => 1253,
		"cornellà de llobregat" => 1254,
		"corró d'amunt" => 79321,
		"corró d'avall" => 79241,
		"cubelles" => 1255,
		"daltmar" => 79260,
		"dosrius" => 1256,
		"el coll" => 79499,
		"el fresno" => 79477,
		"el mirador" => 79328,
		"el mirador de montserrat" => 79252,
		"el soler" => 79360,
		"esglèsia sant martí" => 79475,
		"esparreguera" => 1257,
		"espiells" => 79476,
		"espinalbet" => 79432,
		"esplugues de llobregat" => 1258,
		"l' espunyola" => 1259,
		"l' estany" => 1260,
		"fals" => 79313,
		"figaró" => 79233,
		"figaró-montmany" => 1682,
		"fígols" => 1261,
		"fogars de montclús" => 1262,
		"fogars de la selva" => 1263,
		"folgueroles" => 1264,
		"fonollosa" => 1376,
		"font-rubí" => 1377,
		"fontmartina" => 79264,
		"fontpineda" => 79315,
		"fontsanta" => 79394,
		"les franqueses del vallès" => 1378,
		"fuirosos" => 79329,
		"fumanya" => 79332,
		"fussimanya" => 79291,
		"gaià" => 1382,
		"galera" => 79503,
		"gallecs" => 79306,
		"gallifa" => 1379,
		"gargallà" => 79235,
		"garraf" => 79201,
		"la garriga" => 1380,
		"gavà" => 1381,
		"gavamar" => 79215,
		"gelida" => 1383,
		"gironella" => 1384,
		"gisclareny" => 1385,
		"la granada" => 1386,
		"granera" => 1387,
		"granollers" => 1388,
		"granollers de la plana" => 79269,
		"graugés" => 79327,
		"gréixer" => 79344,
		"gualba" => 1389,
		"guardiola de berguedà" => 1391,
		"guardiola de font-rubí" => 79246,
		"gurb" => 1648,
		"l' hospitalet de llobregat" => 1649,
		"els hostalets de pierola" => 60,
		"igualada" => 1650,
		"joncadella" => 79509,
		"jorba" => 1651,
		"la serra de l'esquirol" => 79297,
		"lavern" => 79341,
		"lavit" => 79465,
		"les cabrunes" => 79414,
		"les pedritxes" => 79350,
		"les pinedes de l'emennol" => 79296,
		"la llacuna" => 1652,
		"la llagosta" => 1653,
		"llerona" => 79238,
		"lliçà d'amunt" => 1655,
		"lliçà de vall" => 1656,
		"llinars" => 79355,
		"llinars del vallès" => 1654,
		"lluçà" => 1657,
		"maçaners" => 79263,
		"maians" => 79323,
		"malanyeu" => 79249,
		"malgrat de mar" => 1658,
		"malla" => 1659,
		"manlleu" => 1660,
		"manresa" => 1661,
		"marata" => 79487,
		"marganell" => 1309,
		"martorell" => 1662,
		"martorelles" => 1663,
		"mas corts" => 79511,
		"les masies de roda" => 1664,
		"les masies de voltregà" => 1665,
		"masquefa" => 1667,
		"matadepera" => 1668,
		"mataró" => 1669,
		"mediona" => 1670,
		"milpins" => 79317,
		"moià" => 22,
		"moja" => 79240,
		"molins de rei" => 1671,
		"mollet del vallès" => 1672,
		"monistrol de calders" => 1676,
		"monistrol de montserrat" => 1675,
		"monistrolet" => 79275,
		"montcada" => 79354,
		"montcada i reixac" => 1673,
		"montclar" => 1678,
		"montesquiu" => 1679,
		"montessol" => 79505,
		"montfalcó gros" => 79408,
		"montgat" => 1674,
		"montjüic" => 79230,
		"montmajor" => 1680,
		"montmaneu" => 1681,
		"montmany" => 79398,
		"montmeló" => 1683,
		"montnegre" => 79236,
		"montornès del vallès" => 20,
		"montseny" => 21,
		"montserrat" => 79195,
		"mosqueroles" => 79245,
		"muntanyola" => 1677,
		"mura" => 24,
		"navarcles" => 25,
		"navàs" => 26,
		"niagara parc" => 79334,
		"nou canyelles" => 79311,
		"la nou de berguedà" => 27,
		"òdena" => 28,
		"olèrdola" => 43,
		"olesa de bonesvalls" => 44,
		"olesa de montserrat" => 45,
		"olivella" => 46,
		"olost" => 47,
		"olvan" => 42,
		"olzinelles" => 79227,
		"ordal" => 79216,
		"orís" => 48,
		"oristà" => 49,
		"orpí" => 50,
		"òrrius" => 51,
		"pacs del penedès" => 52,
		"palafolls" => 53,
		"palau-solità i plegamans" => 54,
		"pallejà" => 55,
		"la palma de cervelló" => 1156,
		"el papiol" => 56,
		"parets del vallès" => 57,
		"peguera" => 79417,
		"perafita" => 58,
		"piera" => 59,
		"pineda de mar" => 61,
		"el pla del penedès" => 62,
		"la pobla de claramunt" => 63,
		"la pobla de lillet" => 64,
		"polígono industrial can castells" => 79434,
		"polinyà" => 1642,
		"el pont de vilomara i rocafort" => 1480,
		"pontons" => 1643,
		"prat" => 79496,
		"el prat de llobregat" => 1644,
		"prats de lluçanès" => 1646,
		"els prats de rei" => 1645,
		"premià de dalt" => 1297,
		"premià de mar" => 1647,
		"puig-reig" => 1473,
		"puigdàlber" => 1472,
		"pujalt" => 1474,
		"la quar" => 1475,
		"queralt" => 79301,
		"rajadell" => 1476,
		"rasos de peguera" => 79194,
		"raval d'aguilera" => 79461,
		"rellinars" => 1477,
		"riells del fai" => 79239,
		"ripollet" => 1478,
		"la roca del vallès" => 1479,
		"roca-rossa" => 79467,
		"roda de ter" => 1481,
		"rofes" => 79366,
		"rubí" => 1482,
		"rubio" => 1483,
		"rupit" => 79200,
		"rupit i pruit" => 1152,
		"sabadell" => 11926,
		"sabanell" => 79490,
		"sagàs" => 65,
		"saldes" => 67,
		"salelles" => 79452,
		"salipota" => 79447,
		"sallent" => 68,
		"saló" => 79430,
		"san miquel del fai" => 79199,
		"san pedro del vim" => 79453,
		"sant adrià de besòs" => 71,
		"sant agustí de lluçanès" => 72,
		"sant andreu de llavaneres" => 74,
		"sant andreu de la barca" => 73,
		"sant andreu de la vola" => 79330,
		"sant antoni de vilamajor" => 75,
		"sant bartomeu del grau" => 76,
		"sant boi de llobregat" => 77,
		"sant boi de lluçanès" => 78,
		"sant cebrià de vallalta" => 80,
		"sant celoni" => 79,
		"sant climent de llobregat" => 81,
		"sant corneli" => 79226,
		"sant cristòfol" => 79248,
		"sant cugat sesgarrigues" => 83,
		"sant cugat del vallès" => 82,
		"sant esteve" => 79437,
		"sant esteve sesrovires" => 85,
		"sant esteve de palautordera" => 84,
		"sant feliu sasserra" => 1684,
		"sant feliu de codines" => 87,
		"sant feliu de llobregat" => 88,
		"sant feliu del ráco" => 79214,
		"sant fost de campsentelles" => 86,
		"sant fruitós de bages" => 1685,
		"sant genís de palafolls" => 79207,
		"sant hipòlit de voltregà" => 1687,
		"sant iscle de vallalta" => 70,
		"sant jaume sesoliveres" => 79497,
		"sant jaume de frontanyà" => 1688,
		"sant joan despí" => 1689,
		"sant joan de mediona" => 79208,
		"sant joan de vilatorrada" => 1690,
		"sant jordi de cercs" => 79237,
		"sant julià de cerdanyola" => 1154,
		"sant julià de vilatorta" => 1692,
		"sant just desvern" => 1693,
		"sant llorenç savall" => 1695,
		"sant llorenç d'hortons" => 1694,
		"sant marçal" => 79380,
		"sant martí sarroca" => 1699,
		"sant martí sesgueioles" => 1700,
		"sant martí d'albars" => 1697,
		"sant martí de centelles" => 1696,
		"sant martí de tous" => 1698,
		"sant mateu de bages" => 1701,
		"sant miquel d'olèrdola" => 79255,
		"sant pau" => 79433,
		"sant pau d'ordal" => 79307,
		"sant pau de pinós" => 79351,
		"sant pere molanta" => 79364,
		"sant pere sacarrera" => 79221,
		"sant pere sallavinera" => 66,
		"sant pere de ferrerons" => 79473,
		"sant pere de ribes" => 1298,
		"sant pere de riudebitlles" => 1299,
		"sant pere de torelló" => 1300,
		"sant pere de vilamajor" => 1301,
		"sant pol de mar" => 1302,
		"sant quintí de mediona" => 1303,
		"sant quirze parc" => 79399,
		"sant quirze safaja" => 1306,
		"sant quirze de besora" => 1304,
		"sant quirze del vallès" => 1305,
		"sant roma de sau" => 79258,
		"sant sadurni" => 79409,
		"sant sadurní d'anoia" => 1307,
		"sant sadurní d'osormort" => 1308,
		"sant salvador de guardiola" => 1390,
		"sant sebastià de montmajor" => 79305,
		"sant vicenç de castellet" => 1329,
		"sant vicenç de montalt" => 1331,
		"sant vicenç de torelló" => 1332,
		"sant vicenç dels horts" => 1330,
		"santa agnès de malanyanes" => 79225,
		"santa cecília de voltregà" => 1310,
		"santa coloma de cervelló" => 1311,
		"santa coloma de gramenet" => 1312,
		"santa eugènia de berga" => 1313,
		"santa eulàlia de puig-oriol" => 79385,
		"santa eulàlia de riuprimer" => 1314,
		"santa eulàlia de ronçana" => 1315,
		"santa fe de montseny" => 79193,
		"santa fe del penedès" => 1316,
		"santa margarida de montbui" => 1317,
		"santa margarida i els monjos" => 1318,
		"santa maria d'oló" => 1325,
		"santa maria de besora" => 1320,
		"santa maria de corcó" => 1321,
		"santa maria de martorelles" => 1323,
		"santa maria de merlès" => 1322,
		"santa maria de miralles" => 1324,
		"santa maria de palautordera" => 1326,
		"santa perpètua de mogoda" => 1327,
		"santa susanna" => 1328,
		"santiga-provasa" => 79507,
		"santpedor" => 69,
		"sentmenat" => 1334,
		"seva" => 1336,
		"sitges" => 1337,
		"sobremunt" => 1338,
		"sora" => 1339,
		"sorba" => 79309,
		"subirats" => 1340,
		"súria" => 1341,
		"tagamanent" => 1343,
		"taiadella" => 79471,
		"talamanca" => 1344,
		"taradell" => 1345,
		"tavèrnoles" => 1342,
		"tavertet" => 1347,
		"teià" => 1348,
		"terrassa" => 1346,
		"tiana" => 1349,
		"togores" => 79506,
		"tona" => 1350,
		"tordera" => 1351,
		"tordera parc" => 79209,
		"torelló" => 1352,
		"torre vileta" => 79287,
		"la torre de claramunt" => 1353,
		"torre-romeu" => 79405,
		"torrebonica" => 79462,
		"torrelavit" => 1354,
		"torrella de baix" => 79386,
		"torrelles de foix" => 1132,
		"torrelles de llobregat" => 1133,
		"torrelletes" => 79396,
		"turó del reig" => 79375,
		"ullastrell" => 1134,
		"urbanització bellavista" => 79470,
		"urbanització bingrau" => 79400,
		"urbanització can santeugini" => 79281,
		"urbanització canyadell" => 79352,
		"urbanització el cassarell" => 79502,
		"urbanització el lledoner" => 79211,
		"urbanitzaciò el muntanyà" => 79206,
		"urbanització la pineda" => 79228,
		"urbanització les amèriques" => 79392,
		"urbanització mas mestre" => 79383,
		"urbanització monterrey parc" => 79472,
		"urbanització montserrat parc" => 79280,
		"urbanització vallbonica" => 79486,
		"urbanització valldemar" => 79299,
		"urbanització vora-sitges" => 79314,
		"urbissol" => 79289,
		"vacarisses" => 1135,
		"vallbona d'anoia" => 1136,
		"vallcarca" => 79234,
		"vallcebre" => 1137,
		"valldoreix" => 79203,
		"vallformosa" => 79318,
		"vallgorguina" => 1138,
		"vallirana" => 1139,
		"vallromanes" => 1140,
		"valls de torroella" => 79220,
		"vallserrat" => 79370,
		"veciana" => 1141,
		"vic" => 2,
		"vilada" => 1142,
		"viladecans" => 1144,
		"viladecavalls" => 1143,
		"viladecavalls de calders" => 79298,
		"viladellops" => 79335,
		"viladomiu vell" => 79393,
		"vilafranca del penedès" => 1148,
		"vilalba sasserra" => 1149,
		"vilanova d'espoia" => 79267,
		"vilanova de sau" => 1146,
		"vilanova del camí" => 1145,
		"vilanova del vallès" => 1153,
		"vilanova i la geltrú" => 1150,
		"vilassar de dalt" => 1686,
		"vilassar de mar" => 1691,
		"vilobí del penedès" => 1147,
		"vinya del pollastre" => 79422,
		"vinyoles d'orís" => 79286,
		"viver i serrateix" => 1151,
		"el bonaire" => 79454,
		"el bruc residencial" => 79197,
		"el calvet" => 79404,
		"el carrer de cal rossell" => 79411,
		"el carrer del castell" => 79455,
		"el farell" => 79358,
		"el feu" => 79410,
		"el guixaró" => 79250,
		"el martivell" => 79457,
		"el mas carbó" => 79478,
		"el mas trader" => 79395,
		"el maset" => 79339,
		"el masnou" => 1666,
		"el mirador del montseny" => 79308,
		"el mujal" => 79494,
		"el pla de l'estació" => 79498,
		"el poal" => 79304,
		"el poblenou" => 79303,
		"el pont de vilomara" => 79217,
		"el prat de vilanova" => 79271,
		"el puig" => 79223,
		"el racó del bosc" => 79510,
		"el raval" => 79479,
		"el romaní" => 79283,
		"el roquet" => 79378,
		"el taió" => 79456,
		"el xup" => 79316,
		"els bassacs" => 79425,
		"els casots" => 79423,
		"els hostalets de balenyà" => 79266,
		"els monjos" => 79261,
		"els saulons" => 79412,
		"els jardins de cunit" => 79300,
		"l'alou" => 79322,
		"l'ametlla de casserres" => 79401,
		"l'arboçar de dalt" => 79482,
		"l'arboçar de les roques" => 79441,
		"l'astor" => 79460,
		"l'avellà" => 79347,
		"l'estació" => 79488,
		"l'oliva" => 79431,
		"l'antiga esquerra de l'eixample" => 519473,
		"la batllòria" => 79320,
		"la beguda alta" => 79295,
		"la beguda baixa" => 79282,
		"la bleda" => 79279,
		"la ciutat jardí" => 79325,
		"la colónia rosal" => 79419,
		"la coma" => 79495,
		"la conreria" => 79348,
		"la costa de cunit" => 79229,
		"la costa del montseny" => 79231,
		"la farga de bebié" => 79421,
		"la floresta" => 79270,
		"la font del bosc" => 79504,
		"la fortesa" => 79372,
		"la front de montnegre" => 79413,
		"la gleva" => 79337,
		"la guàrdia" => 79361,
		"la llavinera" => 79474,
		"la manresana" => 79290,
		"la múnia" => 79484,
		"la muntanya rodona" => 79464,
		"la panadella" => 79198,
		"la pedrosa" => 79331,
		"la pineda" => 79342,
		"la pineda d'en feu" => 79402,
		"la puda de montserrat" => 79272,
		"la ràpita" => 79428,
		"la riba" => 79243,
		"la rierada" => 79512,
		"la roca" => 79277,
		"la rodonella" => 79205,
		"la serreta" => 79365,
		"la solana" => 79446,
		"la torre d'oristà" => 79391,
		"la venta i can mussarro" => 79262,
		"les brucardes" => 79338,
		"les brugueres" => 79388,
		"les carpes" => 79492,
		"les cases noves de can marquès" => 79451,
		"les casetes d'en julià" => 79501,
		"les casetes d'en mussons" => 79480,
		"les clotes" => 79363,
		"les esplugues" => 79438,
		"les faldes del montseny" => 79257,
		"les ferreres" => 79436,
		"les fonts" => 79213,
		"les gunyoles" => 79356,
		"les masuques" => 79469,
		"les palmeres" => 79242,
		"les perellades" => 79440,
		"les pinedes de sant elies" => 79219,
		"les pinedes del castellet" => 79450,
		"les planes" => 79259,
		"les pungoles" => 79232,
		"les roquetes" => 79224
	}

	def available_cities
		AVAILABLE_CITIES
	end

    def getCityId(city)
    	# you should provide a city
    	return false if !city
    	# first tries to match a specific city
    	AVAILABLE_CITIES[city.downcase]
    end

    def getCitySuggestions(city)
    	# this method is used to provide a city suggestion in case we were
    	# not able to found a match

    	# you should provide a city
    	return false if !city

    	# removing the "articles" before cities and trying to find the city
    	# I did that because sometimes someone could search a city like "l'arbrera" like
    	# "arbrera".
    	# Also if the city has multiple words I get the longest one to try to get more matches
    	AVAILABLE_CITIES.keys.select{|a|
    		Regexp.new(city.downcase.split(" ").sort().first) =~ a.gsub(/(^els?|^l[ae]s?)\s|(^l'\s?)/,"")
    	}
    end
  end

  class Error < StandardError; end
  # Your code goes here...
end
